<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<!-- Load d3 -->
<script src="//d3js.org/d3.v5.js"></script>


<h1>Crime in the United States18</h1>


<body onload="main()">
<div id="my_viz">
    <select id="states">
        
    </select>
</div>
<script>

var margin = {top: 20, right: 180, bottom: 30, left: 60},
    width = 850 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
    
var svg = d3.select("#my_viz")
    .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
    .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
var legendLabels = [ "60+", "50-59", "40-49", "30-39", "25-29", "21-24", "18-20", "Under 18"];

var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);
    
//Read the data
async function main() {
    const data = await d3.csv("data/age.csv",
    (d) => {
       return {
           crime: d.crime,
           total: parseFloat(d.total.replace(/,/g, '')),
           under_18: (parseFloat(d.under_18.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _18to20: (parseFloat(d._18to20.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _21to24: (parseFloat(d._21to24.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _25to29: (parseFloat(d._25to29.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _30to39: (parseFloat(d._30to39.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _40to49: (parseFloat(d._40to49.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _50to59: (parseFloat(d._50to59.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _60_plus: (parseFloat(d._60_plus.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
       };
    });

    /*var sel = document.getElementById('states');
    var fragment = document.createDocumentFragment();
    murderData.forEach(function(d) {
        var opt = document.createElement('option');
        opt.value = d.state;
        opt.innerHTML = d.state;
        fragment.appendChild(opt);
    });
    sel.appendChild(fragment);
    d3.select('#states')
        .on('change', function() {
       currentState = d3.select(this).property('value');
        update(murderData.filter(function(d) { return d.state == currentState;}))
    });*/
        var x = d3.scaleBand()
            .domain(data.map(function(d) {return d.crime;}))
            .range([ 0, width])
            .paddingInner(.05);
        svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));
    
        var y = d3.scaleLinear()
            .domain([0,100])
            .range([ height, 0]);
        svg.append("g")
            .call(d3.axisLeft(y));

        var z = d3.scaleOrdinal(d3.schemeCategory10).domain(data.columns.slice(2));
        var stack = d3.stack();

        svg.selectAll(".serie")
            .data(stack.keys(data.columns.slice(2))(data))
            .enter().append("g")
                .attr("class", "serie")
                .attr("fill", function(d) {return z(d.key); })
            .selectAll("rect")
            .data(function(d) { return d; })
            .enter().append("rect")
                .attr("x", function(d) { return x(d.data.crime); })
                .attr("y", function(d) { return y(d[1]); })
                .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                .attr("width", x.bandwidth())
                .on("mouseover", function(d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    var percent = (d[1] - d[0]).toFixed(2);
                    var count = Math.round(d.data.total * ((d[1] - d[0])/100));
                    tooltip.html(count +" people (" + percent + "%)")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY) + "px");          
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
    
        var legend = svg.selectAll(".legend")
            .data(data.columns.slice(2).reverse())
            .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) {return "translate(0," + i*20 + ")";})
                .style("font", "10px sans-serif");
    
        legend.append("rect")
            .attr("x", width + 18)
            .attr("width", 18)
            .attr("height", 18)
            .attr("fill", z);
    
        legend.append("text")
            .attr("x", width + 44)
            .attr("y", 9)
            .attr("dy", ".35em")
            .attr("text-anchor", "start")
            .text(function(d, i) { return legendLabels[i]; });
    
    
    //var currentState = "Michigan";
        
    //updateAge(murderData.filter(function(d) { return d.state == currentState;}));
    
    
    
}

    



</script>
    </body>