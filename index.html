<!DOCTYPE html>
<meta charset="utf-8"
      
<!-- Load d3 -->
<script src="//d3js.org/d3.v5.js"></script>


<h1>Crime in the United States16</h1>


<body onload="main()">
<div id="my_viz">
    <select id="states">
        
    </select>
</div>
<script>

var margin = {top: 20, right: 20, bottom: 30, left: 60},
    width = 600 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
    
var svg = d3.select("#my_viz")
    .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
    .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

//Read the data
async function main() {
    const data = await d3.csv("data/age.csv",
    (d) => {
       return {
           crime: d.crime,
           total: parseFloat(d.total.replace(/,/g, '')),
           under_18: (parseFloat(d.under_18.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _18to20: (parseFloat(d._18to20.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _21to24: (parseFloat(d._21to24.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _25to29: (parseFloat(d._25to29.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _30to39: (parseFloat(d._30to39.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _40to49: (parseFloat(d._40to49.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _50to59: (parseFloat(d._50to59.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
           _60_plus: (parseFloat(d._60_plus.replace(/,/g, ''))/parseFloat(d.total.replace(/,/g, '')))*100,
       };
    });

    /*var sel = document.getElementById('states');
    var fragment = document.createDocumentFragment();
    murderData.forEach(function(d) {
        var opt = document.createElement('option');
        opt.value = d.state;
        opt.innerHTML = d.state;
        fragment.appendChild(opt);
    });
    sel.appendChild(fragment);
    d3.select('#states')
        .on('change', function() {
       currentState = d3.select(this).property('value');
        update(murderData.filter(function(d) { return d.state == currentState;}))
    });*/
    console.log(data);
        var x = d3.scaleBand()
            .domain(data.map(function(d) {return d.crime;}))
            .range([ 0, width])
            .paddingInner(.05);
        g = svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));
    
        var y = d3.scaleLinear()
            .domain([0,100])
            .range([ height, 0]);
        svg.append("g")
            .call(d3.axisLeft(y));

        var z = d3.scaleOrdinal(d3.schemeCategory10).domain(data.columns.slice(2));
        var stack = d3.stack();
        console.log(stack.keys(data.columns.slice(2))(data));
        g.selectAll(".serie")
            .data(stack.keys(data.columns.slice(2))(data))
            .enter().append("g")
                .attr("class", "serie")
                .attr("fill", function(d) {return z(d.key); })
            .selectAll("rect")
            .data(function(d) { return d; })
            .enter().append("rect")
                .attr("x", function(d) { return x(d.data.crime); })
                .attr("y", function(d) { return y(100-d[1]); })
                .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                .attr("width", x.bandwidth());
    
    /*function updateAge(data) {

        var handguns = svg.selectAll(".handguns")
          .data(data);
        
        handguns.enter().append("rect")
          .style("fill", "steelblue")
          .attr("class", "handguns")
          .attr("x", x("Handguns"))
          .attr("width", x.bandwidth());
        
        handguns.transition()
            .duration(500)
          .attr("y", function(d) { return y(d.handguns); })
          .attr("height", function(d) { return height - y(d.handguns); });
        
        handguns.exit().remove();
        
        var rifles = svg.selectAll(".rifles")
          .data(data);
        
        rifles.enter().append("rect")
          .style("fill", "steelblue")
          .attr("class", "rifles")
          .attr("x", x("Rifles"))
          .attr("width", x.bandwidth());
        
        rifles.transition()
          .duration(500)
          .attr("y", function(d) { return y(d.rifles); })
          .attr("height", function(d) { return height - y(d.rifles); });
        
        rifles.exit().remove();
        
        var shotguns = svg.selectAll(".shotguns")
          .data(data);
        
        shotguns.enter().append("rect")
          .style("fill", "steelblue")
          .attr("class", "shotguns")
          .attr("x", x("Shotguns"))
          .attr("width", x.bandwidth());
        
        shotguns.transition()
          .duration(500)
          .attr("y", function(d) { return y(d.shotguns); })
          .attr("height", function(d) { return height - y(d.shotguns); });
        
        shotguns.exit().remove();
        
        var unknown_firearm = svg.selectAll(".unknown_firearm")
          .data(data);
        
        unknown_firearm.enter().append("rect")
          .style("fill", "steelblue")
          .attr("class", "unknown_firearm")
          .attr("x", x("Unknown Firearm"))
          .attr("width", x.bandwidth());
        
        unknown_firearm.transition()
          .duration(500)
          .attr("y", function(d) { return y(d.unknown_firearm); })
          .attr("height", function(d) { return height - y(d.unknown_firearm); });
        
        unknown_firearm.exit().remove();
        
        var knives = svg.selectAll(".knives")
          .data(data);
        
          knives.enter().append("rect")
          .style("fill", "steelblue")
          .attr("class", "knives")
          .attr("x", x("Knives"))
          .attr("width", x.bandwidth());
        
        knives.transition()
          .duration(500)
          .attr("y", function(d) { return y(d.knives); })
          .attr("height", function(d) { return height - y(d.knives); });
        
        knives.exit().remove();
        
        var other_weapon = svg.selectAll(".other_weapon")
          .data(data);

          other_weapon.enter().append("rect")
          .style("fill", "steelblue")
          .attr("class", "other_weapon")
          .attr("x", x("Other Weapon"))
          .attr("width", x.bandwidth());
        
        other_weapon.transition()
          .duration(500)
          .attr("y", function(d) { return y(d.other_weapon); })
          .attr("height", function(d) { return height - y(d.other_weapon); });
        
        other_weapon.exit().remove();
        
        var hands = svg.selectAll(".hands")
          .data(data);
        
          hands.enter().append("rect")
          .style("fill", "steelblue")
          .attr("class", "hands")
          .attr("x", x("Hands"))
          .attr("width", x.bandwidth());
        
        hands.transition()
          .duration(500)
          .attr("y", function(d) { return y(d.hands); })
          .attr("height", function(d) { return height - y(d.hands); });
        
        hands.exit().remove();
    }
    
    //var currentState = "Michigan";
        
    updateAge(murderData.filter(function(d) { return d.state == currentState;}));*/
    
    
    
}

    



</script>
    </body>